<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>V100 Digits Monitor</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    margin: 0;
    background: #0d1117;
    font-family: Arial, sans-serif;
    color: white;
    text-align: center;
}

.header {
    padding: 15px;
    font-size: 20px;
    font-weight: bold;
}

.status {
    font-size: 14px;
    color: #00ff88;
}

.digits {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 8px;
    margin: 20px;
}

.digit {
    width: 55px;
    height: 55px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: bold;
    transition: 0.2s;
}

.even { background: #2979ff; }
.odd { background: #ffc107; }

.highlight {
    border: 3px solid #00ffea;
    transform: scale(1.15);
}

canvas {
    max-width: 95%;
    margin: auto;
}

@media (max-width: 600px) {
    .digit {
        width: 45px;
        height: 45px;
        font-size: 16px;
    }
}
</style>
</head>

<body>

<div class="header">
    Volatility 100 Index
    <div class="status">LIVE</div>
</div>

<div class="digits" id="digits"></div>

<canvas id="chart"></canvas>

<script>
const app_id = "1089"; 
const ws = new WebSocket(`wss://ws.derivws.com/websockets/v3?app_id=${app_id}`);

let digitsBuffer = [];

const ctx = document.getElementById('chart').getContext('2d');

const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            data: [],
            borderColor: '#00f5ff',
            borderWidth: 2,
            tension: 0.3,
            pointRadius: 4,
            pointBackgroundColor: '#ffffff'
        }]
    },
    options: {
        responsive: true,
        animation: false,
        plugins: { legend: { display: false } },
        scales: {
            y: {
                min: 0,
                max: 9,
                ticks: { color: "white" },
                grid: { color: "#222" }
            },
            x: {
                ticks: { color: "white" },
                grid: { color: "#222" }
            }
        }
    }
});

ws.onopen = () => {
    ws.send(JSON.stringify({
        ticks: "R_100",
        subscribe: 1
    }));
};

ws.onmessage = (msg) => {
    const data = JSON.parse(msg.data);
    if (data.tick) {
        const price = data.tick.quote.toString();
        const lastDigit = parseInt(price.slice(-1));

        digitsBuffer.push(lastDigit);
        if (digitsBuffer.length > 10) digitsBuffer.shift();

        updateDigits();
        updateChart();
    }
};

function updateDigits() {
    const container = document.getElementById("digits");
    container.innerHTML = "";

    digitsBuffer.forEach((d, index) => {
        const div = document.createElement("div");
        div.classList.add("digit");
        div.classList.add(d % 2 === 0 ? "even" : "odd");

        if (index === digitsBuffer.length - 1) {
            div.classList.add("highlight");
        }

        div.innerText = d;
        container.appendChild(div);
    });
}

function updateChart() {
    chart.data.labels = digitsBuffer.map((_, i) => i + 1);
    chart.data.datasets[0].data = digitsBuffer;

    chart.data.datasets[0].pointRadius =
        digitsBuffer.map((_, i) =>
            i === digitsBuffer.length - 1 ? 8 : 4
        );

    chart.update();
}
</script>

</body>
</html>
